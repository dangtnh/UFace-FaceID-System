<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UFace ‚Ä¢ Students</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" href="/favicon.ico">

  <link rel="stylesheet" href="/assets/css/uface-theme.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ===== GLOBAL & LAYOUT ===== */
    body {
      margin: 0;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-image: linear-gradient(to bottom right, #c7ddff, #f4f7ff, #ffffff);
      color: #111827;
    }

    .shell {
      min-height: 100vh;
      display: grid;
      grid-template-columns: 250px minmax(0, 1fr);
      gap: 18px;
      padding: 18px 20px;
    }

    .sidebar {
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.08);
      display: flex;
      flex-direction: column;
      padding: 18px 16px 16px;
    }

    .main {
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.09);
      padding: 18px 20px 22px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* ===== SIDEBAR STYLES ===== */
    .sb-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
    }

    .sb-logo-img {
      width: 38px;
      height: 38px;
      border-radius: 16px;
      object-fit: contain;
      background: radial-gradient(circle at 0 0, #38bdf8, #2563eb);
      padding: 4px;
    }

    .sb-title { font-size: 15px; font-weight: 600; }
    .sb-sub { font-size: 11px; color: #9ca3af; }

    .sb-nav {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .sb-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 9px;
      border-radius: 999px;
      font-size: 13px;
      color: #6b7280;
      text-decoration: none;
      transition: all 0.15s;
    }

    .sb-icon {
      width: 20px;
      height: 20px;
      border-radius: 7px;
      background: #eff2ff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #4f46e5;
    }

    .sb-label { flex: 1; }

    .sb-item:hover { background: #f3f4ff; color: #111827; transform: translateY(-1px); }
    
    .sb-item.active {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: #ffffff;
      box-shadow: 0 12px 25px rgba(37, 99, 235, 0.35);
    }
    .sb-item.active .sb-icon { background: rgba(255, 255, 255, 0.16); color: #ffffff; }

    .sb-footer {
      padding-top: 12px;
      border-top: 1px dashed #e5e7eb;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .sb-avatar {
      width: 30px; height: 30px; border-radius: 999px;
      background: #e0ebff; color: #1d4ed8;
      display: flex; align-items: center; justify-content: center;
      font-weight: 600; font-size: 13px;
    }
    .sb-user-name { font-size: 13px; font-weight: 500; }
    .sb-user-role { font-size: 11px; color: #9ca3af; }

    /* ===== TOPBAR & FILTERS ===== */
    .topbar {
      display: flex; justify-content: space-between; align-items: flex-start; gap: 12px;
    }
    .topbar-title { font-size: 20px; font-weight: 600; }
    .topbar-sub { font-size: 13px; color: #6b7280; margin-top: 4px; }
    .topbar-right { font-size: 11px; color: #9ca3af; padding-top: 4px; }

    .filter-bar {
      border-radius: 18px;
      background: radial-gradient(circle at 0 0, #e0ecff, #ffffff);
      border: 1px solid #e5e7eb;
      padding: 10px 14px;
      display: flex; flex-wrap: wrap; gap: 8px 16px;
      align-items: center; justify-content: space-between;
    }
    .filter-group { display: flex; flex-wrap: wrap; gap: 8px 10px; align-items: center; }
    .filter-label { font-size: 12px; font-weight: 500; color: #4b5563; margin-right: 4px; }
    
    .filter-search { position: relative; display: inline-flex; align-items: center; }
    .filter-search input { padding-left: 28px; }
    .search-icon { position: absolute; left: 9px; font-size: 13px; color: #9ca3af; pointer-events: none; }
    
    .filter-input, .filter-select {
      border-radius: 999px; border: 1px solid #e5e7eb;
      padding: 6px 10px; font-size: 12px; outline: none; background: #ffffff;
    }
    .filter-input:focus, .filter-select:focus {
      border-color: #2563eb; box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.18);
    }

    .pill-group {
      display: inline-flex; border-radius: 999px;
      background: rgba(255, 255, 255, 0.85); border: 1px solid #d1d5db; overflow: hidden;
    }
    .pill {
      padding: 5px 12px; font-size: 11px; border: none; background: transparent;
      cursor: pointer; color: #6b7280; transition: 0.12s;
    }
    .pill.active { background: linear-gradient(135deg, #2563eb, #3b82f6); color: #ffffff; }
    .pill + .pill { border-left: 1px solid #e5e7eb; }

    .btn-reset {
      border-radius: 999px; border: 1px solid #cbd5f5; padding: 4px 12px;
      font-size: 11px; background: rgba(255, 255, 255, 0.9); color: #4b5563; cursor: pointer;
    }
    .btn-reset:hover { border-color: #2563eb; color: #1d4ed8; }

    /* ===== STUDENT CARD GRID ===== */
    .students-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      /* ƒê·∫£m b·∫£o grid chi·∫øm kh√¥ng gian nh∆∞ng kh√¥ng tr√†n */
      min-height: 200px; 
    }

    .st-card {
      border-radius: 20px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.04);
      padding: 16px;
      display: flex; flex-direction: column; gap: 12px;
      transition: transform 0.12s ease, border-color 0.12s;
    }
    .st-card:hover { transform: translateY(-3px); border-color: #2563eb; }

    .st-header {
      display: flex; align-items: center; gap: 12px;
    }

    .st-avatar {
      width: 48px; height: 48px; border-radius: 50%;
      background: #eef2ff; color: #2563eb;
      font-size: 18px; font-weight: 600;
      display: flex; align-items: center; justify-content: center;
      border: 2px solid #ffffff;
      box-shadow: 0 4px 10px rgba(37,99,235,0.15);
    }
    .st-avatar.orange { background: #fff7ed; color: #ea580c; }
    .st-avatar.green { background: #f0fdf4; color: #16a34a; }
    .st-avatar.purple { background: #faf5ff; color: #9333ea; }

    .st-info { display: flex; flex-direction: column; overflow: hidden; }
    .st-name { font-size: 14px; font-weight: 600; color: #1f2937; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .st-id { font-size: 11px; color: #6b7280; font-family: monospace; letter-spacing: 0.02em; }

    .st-badges { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 2px; }
    .st-badge {
      border-radius: 6px; padding: 2px 6px; font-size: 10px; font-weight: 500;
    }
    .badge-year { background: rgba(37,99,235,0.08); color: #1d4ed8; }
    .badge-major { background: #f3f4f6; color: #4b5563; border: 1px solid #e5e7eb; }
    .badge-risk { background: #fef2f2; color: #dc2626; border: 1px solid #fee2e2; }

    .st-body {
      padding-top: 12px; border-top: 1px dashed #e5e7eb;
      display: flex; flex-direction: column; gap: 6px;
    }
    .st-row { display: flex; justify-content: space-between; font-size: 12px; }
    .st-label { color: #9ca3af; }
    .st-val { font-weight: 500; color: #374151; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px; }

    .st-actions { margin-top: auto; display: flex; gap: 8px; }
    .btn-view {
      flex: 1; text-align: center;
      padding: 6px; border-radius: 8px;
      font-size: 12px; font-weight: 500;
      background: #eff6ff; color: #2563eb; border: 1px solid transparent;
      cursor: pointer; transition: 0.1s;
    }
    .btn-view:hover { background: #2563eb; color: #ffffff; }

    /* ===== PAGINATION ===== */
    .pagination {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 8px;
      align-items: center;
    }
    .page-btn {
      width: 32px; height: 32px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      color: #6b7280;
      font-size: 13px;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.1s;
    }
    .page-btn:hover:not(:disabled) {
      border-color: #2563eb; color: #2563eb;
    }
    .page-btn.active {
      background: #2563eb; color: white; border-color: #2563eb;
    }
    .page-btn:disabled {
      opacity: 0.5; cursor: not-allowed;
    }
    .page-info {
        font-size: 12px; color: #6b7280; margin: 0 10px;
    }

    /* ===== MODAL ===== */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(2px);
      display: none; align-items: center; justify-content: center; z-index: 50;
    }
    .modal-overlay.open { display: flex; }

    .modal {
      background: #ffffff; border-radius: 20px;
      width: min(500px, 90vw); max-height: 90vh;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.35);
      animation: modalIn 0.2s ease-out;
      display: flex; flex-direction: column;
    }

    .modal-header {
      padding: 18px 20px; border-bottom: 1px solid #e5e7eb;
      display: flex; justify-content: space-between; align-items: center;
    }
    .modal-title { font-size: 16px; font-weight: 600; }
    .modal-close {
      border: none; background: transparent; font-size: 20px; color: #9ca3af; cursor: pointer;
    }

    .modal-content { padding: 20px; overflow-y: auto; }
    
    .m-profile {
      display: flex; align-items: center; gap: 16px; margin-bottom: 20px;
    }
    .m-avatar {
      width: 64px; height: 64px; border-radius: 50%;
      background: #eff6ff; color: #2563eb; font-size: 24px; font-weight: 600;
      display: flex; align-items: center; justify-content: center;
    }
    .m-name { font-size: 18px; font-weight: 600; }
    .m-id { font-size: 13px; color: #6b7280; }
    
    .m-section-title {
      font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.03em;
    }

    @keyframes modalIn {
      from { opacity: 0; transform: translateY(10px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    @media (max-width: 960px) {
      .shell { grid-template-columns: 1fr; padding: 14px; }
      .sidebar { flex-direction: row; gap: 14px; }
      .sb-nav { flex-direction: row; flex-wrap: wrap; justify-content: center; }
      .sb-footer { display: none; }
    }
  </style>
</head>
<body>

<div class="shell">
  <aside class="sidebar">
    <div class="sb-header">
      <img src="/images/logo.png" alt="UFace logo" class="sb-logo-img" />
      <div>
        <div class="sb-title">UFace</div>
        <div class="sb-sub">Smart Attendance</div>
      </div>
    </div>
    
    <nav class="sb-nav">
      <a href="/pages/admin-dashboard.html" class="sb-item">
        <div class="sb-icon">üìä</div>
        <span class="sb-label">Dashboard</span>
      </a>
      <a href="/pages/admin-classes.html" class="sb-item">
        <div class="sb-icon">üè´</div>
        <span class="sb-label">Classes</span>
      </a>
      <a href="/pages/admin-students.html" class="sb-item active">
        <div class="sb-icon">üë®‚Äçüéì</div>
        <span class="sb-label">Students</span>
      </a>
      <a href="/pages/admin-settings.html" class="sb-item">
        <div class="sb-icon">‚öôÔ∏è</div>
        <span class="sb-label">Settings</span>
      </a>
    </nav>

    <div class="sb-footer" style="justify-content: space-between;">
      <div style="display: flex; align-items: center; gap: 10px;">
        <div class="sb-avatar">A</div>
        <div>
          <div class="sb-user-name">Admin</div>
          <div class="sb-user-role">System Admin</div>
        </div>
      </div>
      <button id="logoutBtn" title="Logout" style="background:none;border:none;cursor:pointer;padding:8px;color:#ef4444;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg>
      </button>
    </div>
  </aside>

  <main class="main">
    <header class="topbar">
      <div>
        <div class="topbar-title">Students</div>
        <div class="topbar-sub">Manage student records, enrollment and attendance tracking.</div>
      </div>
      <div class="topbar-right">
        Semester 2024‚Äì2025
      </div>
    </header>

    <section class="filter-bar">
      <div class="filter-group">
        <span class="filter-label">Search:</span>
        <div class="filter-search">
          <span class="search-icon">üîç</span>
          <input id="search-input" class="filter-input" type="text" placeholder="Name / Student ID..." style="width: 220px;" disabled title="Search function coming soon"/>
        </div>
      </div>

      <div class="filter-group">
        <span class="filter-label">Year:</span>
        <div class="pill-group">
          <button class="pill active">All</button>
          <button class="pill">B1</button>
          <button class="pill">B2</button>
          <button class="pill">B3</button>
        </div>
        <button id="btn-refresh" class="btn-reset" type="button" onclick="fetchStudents(1)">Refresh</button>
      </div>
    </section>

    <section class="students-grid" id="students-container">
      <p style="grid-column: 1/-1; text-align: center; color: #6b7280;">Loading students...</p>
    </section>

    <div class="pagination" id="pagination-controls">
        </div>

  </main>
</div>

<div class="modal-overlay" id="studentModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Student Details</div>
      <button class="modal-close" id="modalClose">&times;</button>
    </div>
    <div class="modal-content">
      <div class="m-profile">
        <div class="m-avatar" id="m-avatar">A</div>
        <div>
          <div class="m-name" id="m-name">...</div>
          <div class="m-id" id="m-id">...</div>
          <div style="margin-top:4px; font-size:12px; color:#6b7280;" id="m-email">...</div>
        </div>
      </div>

      <div class="m-section-title">Attendance per Class</div>
      <div class="course-list" id="m-course-list">
        <p style="font-size:12px; color:#9ca3af; font-style:italic;">
           Attendance data is not yet available in API.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  // --- CONFIG ---
  const API_URL = "http://localhost:8000/api/v1/students/"; 
  let currentPage = 1;
  const LIMIT = 10; 

  const gridContainer = document.getElementById('students-container');
  const paginationContainer = document.getElementById('pagination-controls');
  
  let currentStudentsList = [];

  // --- HELPERS ---
  function getAvatarColor(char) {
    if (!char) return 'purple';
    const code = char.charCodeAt(0);
    if (code % 3 === 0) return 'orange';
    if (code % 3 === 1) return 'green';
    return 'purple';
  }

  // --- MAIN FETCH FUNCTION ---
  async function fetchStudents(page = 1) {
    currentPage = page;
    gridContainer.innerHTML = `<p style="grid-column: 1/-1; text-align: center; color: #6b7280;">Loading...</p>`;
    
    try {
      const res = await fetch(`${API_URL}?page=${page}&limit=${LIMIT}`);
      if (!res.ok) throw new Error("Failed to fetch data");
      
      const json = await res.json();
      
      const students = json.data || [];
      const pagination = json.pagination || { totalPages: 1 };
      
      currentStudentsList = students; 
      
      renderStudents(students);
      renderPagination(pagination.totalPages, page);

    } catch (err) {
      console.error(err);
      gridContainer.innerHTML = `<p style="grid-column: 1/-1; text-align: center; color: #dc2626;">Error loading students. Please try again.</p>`;
    }
  }

  // --- RENDER GRID ---
  function renderStudents(list) {
    gridContainer.innerHTML = "";
    
    if (list.length === 0) {
      gridContainer.innerHTML = `<p style="grid-column: 1/-1; text-align: center; color: #9ca3af;">No students found.</p>`;
      return;
    }

    list.forEach(student => {
      const name = student.fullName || "Unknown";
      const id = student.studentId || "N/A";
      const email = student.schoolEmail || "";
      const firstChar = name.charAt(0).toUpperCase();
      const colorClass = getAvatarColor(firstChar);

      const cardHTML = `
        <div class="st-card">
          <div class="st-header">
            <div class="st-avatar ${colorClass}">${firstChar}</div>
            <div class="st-info">
              <div class="st-name" title="${name}">${name}</div>
              <div class="st-id">${id}</div>
              <div class="st-badges">
                <span class="st-badge badge-year">B?</span> <span class="st-badge badge-major">Major?</span> </div>
            </div>
          </div>
          <div class="st-body">
            <div class="st-row">
              <span class="st-label">Email</span>
              <span class="st-val" title="${email}">${email}</span>
            </div>
            <div class="st-row">
              <span class="st-label">Status</span>
              <span class="st-val" style="color: #16a34a;">Active</span>
            </div>
          </div>
          <div class="st-actions">
            <button class="btn-view" onclick="openModal('${student.id}')">View Details</button>
          </div>
        </div>
      `;
      gridContainer.innerHTML += cardHTML;
    });
  }

  // --- RENDER PAGINATION ---
  function renderPagination(totalPages, current) {
    paginationContainer.innerHTML = "";
    
    if (totalPages <= 1) return; 

    // N√∫t Prev
    const prevBtn = document.createElement("button");
    prevBtn.className = "page-btn";
    prevBtn.innerHTML = "&lt;";
    prevBtn.disabled = current === 1;
    prevBtn.onclick = () => fetchStudents(current - 1);
    paginationContainer.appendChild(prevBtn);

    // Th√¥ng tin trang (Page X of Y)
    const info = document.createElement("span");
    info.className = "page-info";
    info.textContent = `Page ${current} of ${totalPages}`;
    paginationContainer.appendChild(info);

    // N√∫t Next
    const nextBtn = document.createElement("button");
    nextBtn.className = "page-btn";
    nextBtn.innerHTML = "&gt;";
    nextBtn.disabled = current === totalPages;
    nextBtn.onclick = () => fetchStudents(current + 1);
    paginationContainer.appendChild(nextBtn);
  }

  // --- MODAL LOGIC ---
  const modal = document.getElementById('studentModal');
  const modalClose = document.getElementById('modalClose');

  window.openModal = function(dbId) {
    const s = currentStudentsList.find(x => x.id == dbId);
    if (!s) return;

    // Fill th√¥ng tin v√†o Modal
    document.getElementById('m-name').textContent = s.fullName;
    document.getElementById('m-id').textContent = s.studentId;
    document.getElementById('m-email').textContent = s.schoolEmail;
    
    const firstChar = s.fullName.charAt(0).toUpperCase();
    const av = document.getElementById('m-avatar');
    av.textContent = firstChar;
    av.className = `m-avatar ${getAvatarColor(firstChar)}`;

    // M·ªü Modal
    modal.classList.add('open');
  }

  modalClose.addEventListener('click', () => modal.classList.remove('open'));
  modal.addEventListener('click', (e) => {
    if (e.target === modal) modal.classList.remove('open');
  });

  // --- INIT ---
  document.addEventListener('DOMContentLoaded', () => {
    fetchStudents(1); // Load trang 1 ngay khi v√†o web
  });

</script>
<script src="/assets/js/logout.js"></script>
</body>
</html>